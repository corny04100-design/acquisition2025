<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>취득세 계산 · 메뉴</title>
<meta name="theme-color" content="#2c58ff" />
<link rel="manifest" href="manifest.webmanifest?v=20250916">
<link rel="icon" href="./icon-192-v5.png" sizes="192x192" />
<link rel="apple-touch-icon" href="./icon-512-v5.png" />
<style>
:root{
  --bg:#f9fafb; --card:#ffffff; --text:#111827; --text-sub:#6b7280;
  --brand:#2563eb; --brand-weak:#eff6ff; --sum-bg:#f3f4f6;
  --input-bg:#fefce8; --line:#e5e7eb; --shadow:rgba(0,0,0,.06);
  --warn:#dc2626; --muted:#9ca3af;
}
html,body{margin:0;padding:0;height:100%;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);line-height:1.65}
.hidden{display:none !important}

/* 공통 헤더 */
header.appbar{position:sticky;top:0;z-index:50;background:var(--card);backdrop-filter:blur(8px);border-bottom:1px solid var(--line);box-shadow:0 1px 3px var(--shadow)}
header .row{max-width:960px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:8px;flex-wrap:nowrap}
.brand{display:flex;align-items:center;gap:8px;font-weight:700;font-size:0.95rem;white-space:nowrap}
.brand .logo{display:none}
.app-actions{display:flex;gap:6px;margin-left:auto;flex-wrap:nowrap}
.icon-btn{padding:6px 10px;border:1px solid var(--line);border-radius:8px;background:var(--brand-weak);font-size:0.78rem;font-weight:700;color:var(--text);text-decoration:none;transition:background .15s;white-space:nowrap}
.icon-btn:hover{background:#dbeafe}
.icon-btn.icon-only{width:38px;height:38px;padding:0;display:inline-flex;align-items:center;justify-content:center}
.icon-btn.icon-only svg{width:20px;height:20px}
.icon-stroke{fill:none;stroke:#1f2937;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}
.installed .btn-install{display:none !important}

/* 공통 레이아웃 */
.wrap{max-width:960px;margin:20px auto 80px;padding:0 16px}
.title{font-size:1.3rem;font-weight:800;margin-bottom:10px;text-align:center}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:24px;box-shadow:0 4px 12px var(--shadow)}
.btn{display:inline-flex;align-items:center;gap:6px;padding:10px 18px;border-radius:10px;background:var(--brand);color:#fff;font-weight:700;cursor:pointer;transition:filter .15s}
.btn:hover{filter:brightness(1.05)}

/* 스플래시 */
#splash{position:fixed;inset:0;background:linear-gradient(135deg,#2563eb,#1d4ed8);display:flex;align-items:center;justify-content:center;color:#fff;z-index:100}
#splash h1{font-size:2rem;letter-spacing:.08em}

/* 메뉴 */
#view-menu .menu-wrap{max-width:640px;margin:0 auto}
.menu-grid{display:grid;grid-template-columns:1fr;gap:14px}
.menu-item{display:flex;align-items:center;gap:14px;padding:18px;border:1px solid var(--line);border-radius:14px;background:var(--card);box-shadow:0 4px 12px var(--shadow);cursor:pointer;text-decoration:none;color:inherit}
.menu-item:hover{background:#f8fafc}
/* 2번(준비 완료) 기본 강조 */
.menu-item.ready{background:#fef2f2;border-color:#fecaca}
.menu-item.ready .menu-num{background:#fee2e2}
.menu-item.ready:hover{background:#fee2e2}
/* [신규] 3번 상속 취득 카드: 옅은 하늘색 */
.menu-item.sky{background:#e0f2fe !important;border-color:#bae6fd !important}
.menu-item.sky:hover{background:#dbeafe !important}
.menu-num{min-width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:var(--brand-weak);font-weight:800}
.menu-text{font-size:1.05rem;font-weight:700}
.menu-note{font-size:.85rem;color:var(--text-sub)}

/* 표/입력(2/3번 화면에서 사용) */
.grid{display:grid;grid-template-columns:50% 50%;gap:20px}
#view-calc2 .grid{grid-template-columns:1fr !important}
#view-calc3 .grid{grid-template-columns:1fr !important}
.header-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
h2{font-size:1.05rem;margin:0}
h2 .unit{font-size:0.75rem;color:var(--text-sub)}
label{font-size:0.9rem;color:var(--text-sub);margin-bottom:4px;display:block}
input.num{width:50%;display:block;margin:0 auto;padding:12px;border:1px solid #d1d5db;border-radius:10px;background:var(--input-bg);text-align:right;font-size:1rem}
.table{width:100%;border-collapse:collapse;margin-top:10px;font-size:0.9rem}
.table th,.table td{padding:10px;border-bottom:1px solid var(--line)}
.table th{text-align:center;background:var(--bg)}
.table td{text-align:right}
.table td:first-child{text-align:center}
tfoot tr{background:var(--sum-bg);font-weight:700}
.sum-box{background:var(--brand-weak);border:1px solid #bfdbfe;border-radius:12px;padding:16px;margin:12px 0;display:grid;grid-template-columns:1fr 1fr;gap:10px;text-align:center;font-weight:700}
.warn{color:var(--warn);font-size:0.85rem;margin-top:10px;text-align:right}
.sum-box .label{font-size:0.78rem;color:#374151}
.sum-box .value{font-size:1.125rem}
.sum-box .value.note{font-size:0.75rem}
.nowrap{white-space:nowrap}
.center-30{width:60%;min-width:420px;max-width:680px;margin:16px auto 0 auto}
.nowrap td,.nowrap th{white-space:nowrap}
/* 모든 한글 문구 중앙 정렬 */
.title,.brand,.header-row h2,label,summary,.warn,.sum-box .label,.sum-box .value{ text-align:center; }
.table tfoot th:nth-child(2), .table tfoot th:nth-child(3){text-align:right}

/* 인쇄 최적화 */
@media print{
  @page{size:A4 portrait;margin:10mm}
  body{font-size:11pt}
  .wrap{max-width:100%;margin:0;padding:0}
  .grid{grid-template-columns:1fr 1fr;gap:8px}
  .card{padding:10px;box-shadow:none;border-color:#e5e7eb}
  .sum-box{margin:6px 0;padding:10px}
  .table{font-size:10pt}
  .table th,.table td{padding:6px}
  .title{margin:4px 0 8px 0;font-size:16pt}
  header.appbar,.app-actions,.menu-wrap,#splash{display:none !important}
}
#view-calc2 .input-grid, #view-calc3 .input-grid{display:grid;grid-template-columns:7fr 3fr;gap:12px;align-items:end;margin-bottom:12px}
#view-calc2 .input-grid input.num, #view-calc3 .input-grid input.num{width:100%}
#view-calc2 input.date, #view-calc3 input.date{display:block;margin:0 auto;padding:12px;border:1px solid #d1d5db;border-radius:10px;background:#ffffff;text-align:center;font-size:1rem}
.deadline-box{background:var(--brand-weak);border:1px dashed #bfdbfe;border-radius:12px;padding:12px;text-align:center}
.deadline-box .label{font-size:.8rem;color:#374151}
.deadline-box .value{font-size:1.05rem;font-weight:700}

/* PWA 모드에서는 CSS만으로도 숨김 처리 (추가 보강) */
@media all and (display-mode: standalone), all and (display-mode: window-controls-overlay){
  .btn-install{display:none !important}
}

/* ====== 상속 취득 체크박스 + 박스 스타일 ====== */
#view-calc3 .type-options{display:flex;gap:16px;justify-content:flex-start;flex-wrap:wrap;margin-bottom:10px}
#view-calc3 .type-options label{display:inline-flex;align-items:center;gap:6px;text-align:left !important}
#view-calc3 .area-options{display:flex;flex-direction:column;gap:10px;justify-content:flex-start;flex-wrap:nowrap;margin:6px 0 8px 0}
#view-calc3 .area-options label{display:inline-flex;align-items:center;gap:6px}
#view-calc3 .type-options label span,
#view-calc3 .area-options label span{
  color:var(--text);
  font-weight:800;
  font-size:1.05rem;
}
/* 옅은 초록/하늘 박스 */
.pill{border:1px solid var(--line);border-radius:12px;padding:10px 12px;display:flex;gap:16px;flex-wrap:wrap;align-items:center}
.pill.green{background:#ecfdf5;border-color:#bbf7d0}
.pill.sky{background:#e0f2fe;border-color:#bae6fd}
.pill label{margin:2px 0}
/* 특례 문구: 줄바꿈 금지 + 크기/자간 축소 */
.special-tight{white-space:nowrap;font-size:.9rem;letter-spacing:-.02em;line-height:1.2}
</style>
</head>
<body>
  <!-- 스플래시: 1.5초 후 자동 전환 -->
  <div id="splash" role="status" aria-live="polite"><h1>취득세 계산</h1></div>

  <!-- 메뉴 화면 -->
  <div id="view-menu" class="view">
    <header class="appbar">
      <div class="row">
        <div class="brand"><span>취득유형 선택</span></div>
        <div class="app-actions">
          <a class="icon-btn" target="_blank" href="https://www.law.go.kr/LSW/lsSc.do?query=%EC%A7%80%EB%B0%A9%EC%84%B8%EB%B2%95">🔍 지방세법</a>
          <a class="icon-btn" target="_blank" href="https://www.wetax.go.kr/etq/etp/epi/E070101M01.do">🧾 위택스</a>
          <a class="icon-btn btn-install" href="javascript:void(0)" onclick="openInstall()" title="앱 설치" aria-label="앱 설치">앱설치</a>
        </div>
      </div>
    </header>
    <div class="wrap">
      <div class="title">취득유형 선택</div>
      <div class="menu-wrap">
        <div class="menu-grid" role="navigation" aria-label="취득 유형 선택">
          <button class="menu-item" onclick="showView('coming1')">
            <div class="menu-num">1</div>
            <div>
              <div class="menu-text">주택 매매 취득</div>
              <div class="menu-note">준비 중</div>
            </div>
          </button>
          <button class="menu-item ready" onclick="showView('calc2')">
            <div class="menu-num">2</div>
            <div>
              <div class="menu-text">상가(오피스텔) 매매 취득</div>
            </div>
          </button>
          <!-- [신규] sky 클래스 추가 -->
          <button class="menu-item ready sky" onclick="showView('calc3')">
            <div class="menu-num">3</div>
            <div>
              <div class="menu-text">상속 취득</div>
            </div>
          </button>
          <button class="menu-item" onclick="showView('coming4')">
            <div class="menu-num">4</div>
            <div>
              <div class="menu-text">증여 취득</div>
              <div class="menu-note">준비 중</div>
            </div>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 1/4 번: 준비 중 화면들 -->
  <div id="view-coming1" class="view hidden">
    <div class="wrap">
      <div class="card" style="text-align:center">
        <div class="title">주택 매매 취득</div>
        <p style="color:var(--text-sub)">이 기능은 준비 중입니다.</p>
        <button class="btn" onclick="showView('menu')">← 메뉴로</button>
      </div>
    </div>
  </div>
  <div id="view-coming4" class="view hidden">
    <div class="wrap">
      <div class="card" style="text-align:center">
        <div class="title">증여 취득</div>
        <p style="color:var(--text-sub)">이 기능은 준비 중입니다.</p>
        <button class="btn" onclick="showView('menu')">← 메뉴로</button>
      </div>
    </div>
  </div>

  <!-- 2번: 상가(오피스텔) 매매 취득 계산기 -->
  <div id="view-calc2" class="view hidden" aria-labelledby="calc2-heading">
    <header class="appbar">
      <div class="row">
        <a class="icon-btn icon-only" href="javascript:void(0)" onclick="showView('menu')" title="뒤로" aria-label="뒤로">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path class="icon-stroke" d="M15 18l-6-6 6-6"/></svg>
        </a>
        <div class="brand"><span>2025년 취득세 계산(상가 등 유상취득)</span></div>
        <div class="app-actions">
          <a class="icon-btn icon-only" href="javascript:void(0)" onclick="openPrint()" title="인쇄 미리보기" aria-label="인쇄">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path class="icon-stroke" d="M7 8V4h10v4M6 17H5a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-1M7 14h10v6H7zM17 11h.01"/></svg>
          </a>
          <a class="icon-btn icon-only" href="javascript:void(0)" onclick="openPrint()" title="PDF로 저장" aria-label="PDF 저장">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="3" width="18" height="18" rx="2" class="icon-stroke"/>
              <rect x="6" y="5.5" width="9" height="6" class="icon-stroke"/>
              <rect x="17" y="6.5" width="3" height="3" fill="#1f2937"/>
              <line x1="6" y1="16.5" x2="18" y2="16.5" class="icon-stroke"/>
            </svg>
          </a>
          <a class="icon-btn" target="_blank" href="https://www.law.go.kr/LSW/lsSc.do?query=%EC%A7%80%EB%B0%A9%EC%84%B8%EB%B2%95">🔍 지방세법</a>
          <a class="icon-btn" target="_blank" href="https://www.wetax.go.kr/etq/etp/epi/E070101M01.do">🧾 위택스</a>
          <a class="icon-btn btn-install" href="javascript:void(0)" onclick="openInstall()" title="앱 설치" aria-label="앱 설치">앱설치</a>
        </div>
      </div>
    </header>
    <div class="wrap">
      <h1 id="calc2-heading" class="title">2025년 취득세 계산(상가 등 유상취득)</h1>
      <div class="grid">
        <div class="card">
          <div class="header-row"><h2>1. 취득 정보 입력 <span class="unit">(단위: 원)</span></h2></div>
          <div class="input-grid">
            <div class="col col-amount">
              <label for="취득가액">취득가액(매매가)</label>
              <input id="취득가액" class="num" type="text" inputmode="numeric" placeholder="숫자만 입력" />
            </div>
            <div class="col col-date">
              <label for="잔금지급일">잔금지급일</label>
              <input id="잔금지급일" type="date" class="date" />
            </div>
          </div>
          <div style="margin-top:14px;text-align:center"><button class="btn" onclick="calc2()">✍️ 계산하기</button></div>
          <details class="center-30" style="margin-top:16px" open>
            <summary>세율 및 과세표준</summary>
            <table class="table nowrap">
              <tbody>
                <tr><td>과세표준</td><td id="과표">-</td></tr>
                <tr><td>취득세</td><td>4%</td></tr>
                <tr><td>농어촌특별세</td><td>0.2%</td></tr>
                <tr><td>지방교육세</td><td>0.4%</td></tr>
              </tbody>
            </table>
          <div class="deadline-box center-30" style="margin-top:10px">
            <div class="label">취득세 납부기한</div>
            <div class="value" id="납부기한">-</div>
          </div>
        </div>
        <div class="card">
          <h2>2. 산출 세액</h2>
          <div class="sum-box" role="status" aria-live="polite">
            <div>
              <div class="label">총 합계 세액</div>
              <div class="value" id="sum_total">-</div>
            </div>
            <div>
              <div class="label">납부 안내</div>
              <div class="value note nowrap" id="sum_guide">취득(잔금지급일)일로부터 60일 내</div>
            </div>
          </div>
          <table class="table">
            <thead><tr><th>세목</th><th>세율</th><th>세액</th></tr></thead>
            <tbody id="tb"><tr><td colspan="3" style="text-align:center;color:#6b7280">입력 후 ‘계산하기’를 눌러주세요.</td></tr></tbody>
            <tfoot><tr><th>합계 세액</th><th>4.6%</th><th id="sumY">-</th></tr></tfoot>
          </table>
          <div class="warn">※ 실제 고지서는 감면·중과, 절사 방식 등으로 차이가 있을 수 있으니 최종 고지서를 확인하세요.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- 3번: 상속 취득 계산기 -->
  <div id="view-calc3" class="view hidden" aria-labelledby="calc3-heading">
    <header class="appbar">
      <div class="row">
        <a class="icon-btn icon-only" href="javascript:void(0)" onclick="showView('menu')" title="뒤로" aria-label="뒤로">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path class="icon-stroke" d="M15 18l-6-6 6-6"/></svg>
        </a>
        <div class="brand"><span>2025년 취득세 계산(상속 취득)</span></div>
        <div class="app-actions">
          <a class="icon-btn icon-only" href="javascript:void(0)" onclick="openPrint()" title="인쇄 미리보기" aria-label="인쇄">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path class="icon-stroke" d="M7 8V4h10v4M6 17H5a 2 2 0 0 1-2-2v-3a 2 2 0 0 1 2-2h14a 2 2 0 0 1 2 2v3a 2 2 0 0 1-2 2h-1M7 14h10v6H7zM17 11h.01"/></svg>
          </a>
          <a class="icon-btn icon-only" href="javascript:void(0)" onclick="openPrint()" title="PDF로 저장" aria-label="PDF 저장">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="3" width="18" height="18" rx="2" class="icon-stroke"/>
              <rect x="6" y="5.5" width="9" height="6" class="icon-stroke"/>
              <rect x="17" y="6.5" width="3" height="3" fill="#1f2937"/>
              <line x1="6" y1="16.5" x2="18" y2="16.5" class="icon-stroke"/>
            </svg>
          </a>
          <a class="icon-btn" target="_blank" href="https://www.law.go.kr/LSW/lsSc.do?query=%EC%A7%80%EB%B0%A9%EC%84%B8%EB%B2%95">🔍 지방세법</a>
          <a class="icon-btn" target="_blank" href="https://www.wetax.go.kr/etq/etp/epi/E070101M01.do">🧾 위택스</a>
          <a class="icon-btn btn-install" href="javascript:void(0)" onclick="openInstall()" title="앱 설치" aria-label="앱 설치">앱설치</a>
        </div>
      </div>
    </header>
    <div class="wrap">
      <h1 id="calc3-heading" class="title">2025년 취득세 계산(상속 취득)</h1>
      <div class="grid">
        <div class="card">
          <div class="header-row"><h2>1. 취득 정보 입력 <span class="unit">(단위: 원)</span></h2></div>

          <!-- 유형 체크박스 -->
          <div class="type-options" id="typeOptions">
            <label><input type="checkbox" id="isHouse"/> <span>1. 주택</span></label>
            <label><input type="checkbox" id="isNonHouse"/> <span>2. 주택이 아닌 부동산</span></label>
          </div>

          <!-- 전용면적(초록 박스) + 특례(하늘 박스) -->
          <div id="areaOptions" class="area-options hidden" aria-live="polite">
            <div class="pill green" id="areaBox" role="group" aria-label="전용면적 선택">
              <label><input type="checkbox" id="area_le_85" /> <span>전용면적 85m² 이하</span></label>
              <label><input type="checkbox" id="area_gt_85" /> <span>전용면적 85m² 초과</span></label>
            </div>
            <div class="pill sky" id="specialBox" role="group" aria-label="세율 특례 선택">
              <label title="체크 시 취득세율 0.8% 적용 및 농어촌특별세 미부과">
                <input type="checkbox" id="one_home_special" />
                <span class="special-tight">1가구 1주택 세율 특례대상(판단기준 ①지분이 가장 큰 자 ②상속주택 거주자 ③연장자</span>
              </label>
            </div>
          </div>
          <div class="input-grid">
            <div class="col col-amount">
              <label for="상속_과세표준">과세표준(주택공시가격 또는 건물·토지 시가표준액)</label>
              <input id="상속_과세표준" class="num" type="text" inputmode="numeric" placeholder="숫자만 입력" />
            </div>
            <div class="col col-date">
              <label for="사망일">사망일(상속개시일)</label>
              <input id="사망일" type="date" class="date" />
            </div>
          </div>
          <div style="margin-top:14px;text-align:center"><button class="btn" onclick="calc3()">✍️ 계산하기</button></div>
          <details class="center-30" style="margin-top:16px" open>
            <summary>세율 및 과세표준</summary>
            <table class="table nowrap">
              <tbody>
                <tr><td>과세표준</td><td id="상속_과표">-</td></tr>
                <tr><td>취득세</td><td id="상속_취득세율셀">2.8%</td></tr>
                <tr><td>농어촌특별세</td><td id="상속_농특세율셀">0.2%</td></tr>
                <tr><td>지방교육세</td><td>0.16%</td></tr>
              </tbody>
            </table>
            <div class="deadline-box center-30" style="margin-top:10px">
              <div class="label">취득세 납부기한</div>
              <div class="value" id="상속_납부기한">-</div>
            </div>
          </details>
        </div>
        <div class="card">
          <h2>2. 산출 세액</h2>
          <div class="sum-box" role="status" aria-live="polite">
            <div>
              <div class="label">총 합계 세액</div>
              <div class="value" id="상속_sum_total">-</div>
            </div>
            <div>
              <div class="label">납부 안내</div>
              <div class="value note nowrap" id="상속_sum_guide">사망일(상속개시일)로부터 6개월 내</div>
            </div>
          </div>
          <table class="table">
            <thead><tr><th>세목</th><th>세율</th><th>세액</th></tr></thead>
            <tbody id="상속_tb"><tr><td colspan="3" style="text-align:center;color:#6b7280">입력 후 ‘계산하기’를 눌러주세요.</td></tr></tbody>
            <tfoot><tr><th>합계 세액</th><th id="상속_합계세율표시">3.16%</th><th id="상속_sumY">-</th></tr></tfoot>
          </table>
          <div class="warn">※ 실제 고지서는 감면·중과, 절사 방식 등으로 차이가 있을 수 있으니 최종 고지서를 확인하세요.</div>
        </div>
      </div>
    </div>
  </div>

<script>
// --- 뷰 전환 & 스플래시 ---
function showView(name){
  document.querySelectorAll('.view').forEach(v=>v.classList.add('hidden'));
  const el=document.getElementById('view-'+name);
  if(el){ el.classList.remove('hidden'); window.scrollTo(0,0); }
}
window.addEventListener('load',()=>{
  // 1.5초 스플래시 후 메뉴 노출
  setTimeout(()=>{
    const sp=document.getElementById('splash'); if(sp) sp.classList.add('hidden');
    showView('menu');
  },1500);
});
</script>

<script>
// --- 공통 유틸 & 포매터 ---
const $=id=>document.getElementById(id);
const setText=(id,v)=>{const el=$(id);if(el)el.textContent=v;}
const setHTML=(id,v)=>{const el=$(id);if(el)el.innerHTML=v;}
const numOf=id=>Number((($(id)?.value)||'').replace(/,/g,'')||0);
const floor10=n=>Math.floor(n/10)*10; // 10원 절사
const fmt=n=>(Number.isFinite(n)?Math.floor(n).toLocaleString('ko-KR')+'원':'-');

// 날짜 유틸
const parseLocalDate=s=>{ if(!s) return null; const [y,m,d]=s.split('-').map(Number); return new Date(y, (m||1)-1, d||1); };
const addDays=(date,days)=>{ const d=new Date(date.getFullYear(), date.getMonth(), date.getDate()+days); return d; };
const addMonths=(date,months)=>{ const d=new Date(date.getFullYear(), date.getMonth(), date.getDate()); d.setMonth(d.getMonth()+months); if(d.getDate()!==date.getDate()){ d.setDate(0); } return d; };
const formatYMD=d=>{ if(!d||Number.isNaN(+d)) return '-'; const y=d.getFullYear(); const m=String(d.getMonth()+1).padStart(2,'0'); const dd=String(d.getDate()).padStart(2,'0'); return `${y}-${m}-${dd}`; };

// 숫자 입력 3자리 콤마
document.addEventListener('input',e=>{if(e.target.classList.contains('num')){let v=e.target.value.replace(/,/g,'').replace(/[^\d]/g,'');if(v===''){e.target.value='';return;}e.target.value=v.replace(/\B(?=(\d{3})+(?!\d))/g,",");}});
</script>

<script>
// --- (2번) 상가 등 유상취득 계산기 로직 + 납부기한(잔금지급일+60일) ---
const ACQ_RATE=0.04, NTS_RATE=0.002, EDU_RATE=0.004, TOTAL_RATE=ACQ_RATE+NTS_RATE+EDU_RATE;
function calc2(){
  const base=numOf('취득가액');
  const acq=floor10(base*ACQ_RATE), nts=floor10(base*NTS_RATE), edu=floor10(base*EDU_RATE);
  const sum=acq+nts+edu;
  const rows=[["취득세","4%",fmt(acq)],["농어촌특별세","0.2%",fmt(nts)],["지방교육세","0.4%",fmt(edu)]].map(([n,r,a])=>`<tr><td>${n}</td><td>${r}</td><td>${a}</td></tr>`).join('');
  setHTML('tb',rows); setText('sumY',fmt(sum)); setText('sum_total',fmt(sum)); setText('과표',fmt(base));
  setText('sum_guide','취득(잔금지급일)일로부터 60일 내');

  const payDateStr = $('잔금지급일')?.value || '';
  let deadline='-';
  if(payDateStr){ const d=parseLocalDate(payDateStr); if(d){ deadline = formatYMD(addDays(d,60)); } }
  setText('납부기한', deadline);
}
document.addEventListener('change',e=>{ if(e.target && (e.target.id==='잔금지급일')){ calc2(); }});
</script>

<script>
// --- (3번) 상속 취득 계산기 로직 + 납부기한(사망일+6개월) ---
// 기본 세율(주택/비주택 공통 기본)
const I_ACQ_RATE_DEFAULT=0.028, I_ACQ_RATE_SPECIAL=0.008; // 특례시 0.8%
const I_NTS_RATE=0.002, I_EDU_RATE=0.0016; // 교육세 고정

// 주택 선택 시 전용면적 옵션 표시/숨김, 상호배타 체크 처리
function refreshAreaOptions(){
  const isHouse = $('isHouse')?.checked;
  const isNonHouse = $('isNonHouse')?.checked;
  // 주택만 체크된 경우에만 전용면적/특례 박스 노출
  const showArea = !!isHouse && !isNonHouse;
  const areaBox = $('areaOptions');
  if(areaBox){ areaBox.classList.toggle('hidden', !showArea); }
  // 해제 시 선택 초기화
  if(!showArea){
    const le = $('area_le_85'), gt = $('area_gt_85'), sp=$('one_home_special');
    if(le) le.checked=false;
    if(gt) gt.checked=false;
    if(sp) sp.checked=false;
  }
}

// 면적 옵션 상호배타
function toggleArea(exclusiveId){
  const ids = ['area_le_85','area_gt_85'];
  ids.forEach(id=>{
    if(id!==exclusiveId){
      const el=$(id); if(el) el.checked=false;
    }
  });
  // 85m² 이하로 바꾸면 특례는 해제(조건 미충족)
  if(exclusiveId==='area_le_85'){
    const sp=$('one_home_special'); if(sp) sp.checked=false;
  }
}

function calc3(){
  const base=numOf('상속_과세표준');
  const isHouse = $('isHouse')?.checked || false;
  const isNonHouse = $('isNonHouse')?.checked || false;
  const le85 = $('area_le_85')?.checked || false;
  const gt85 = $('area_gt_85')?.checked || false;
  const special = $('one_home_special')?.checked || false;

  // 농어촌특별세율 기본 로직
  let ntsRate = I_NTS_RATE;
  let ntsRateLabel = '0.2%';
  if(isHouse && !isNonHouse){
    if(le85){
      ntsRate = 0;
      ntsRateLabel = '미부과';
    }else{
      ntsRate = I_NTS_RATE;
      ntsRateLabel = '0.2%';
    }
  }else{
    ntsRate = I_NTS_RATE;
    ntsRateLabel = '0.2%';
  }
  // [신규] 특례 체크 시 농특세 무조건 미부과
  if(special){
    ntsRate = 0;
    ntsRateLabel = '미부과';
  }

  // 취득세율(기본 2.8%, 특례 체크 시 0.8%) — 특례는 주택만 & 85m² 초과 선택 시에만 적용
  let acqRate = I_ACQ_RATE_DEFAULT;
  if(isHouse && !isNonHouse && gt85 && special){
    acqRate = I_ACQ_RATE_SPECIAL;
  }
  const acqRateLabel = (acqRate*100).toFixed(1) + '%';

  const acq=floor10(base*acqRate);
  const nts=floor10(base*ntsRate);
  const edu=floor10(base*I_EDU_RATE);
  const sum=acq+nts+edu;

  const rows=[
    ["취득세",acqRateLabel,fmt(acq)],
    ["농어촌특별세",ntsRateLabel,fmt(nts)],
    ["지방교육세","0.16%",fmt(edu)],
  ].map(([n,r,a])=>`<tr><td>${n}</td><td>${r}</td><td>${a}</td></tr>`).join('');
  setHTML('상속_tb',rows);
  setText('상속_sumY',fmt(sum));
  setText('상속_sum_total',fmt(sum));
  setText('상속_과표',fmt(base));
  setText('상속_농특세율셀', ntsRateLabel);
  setText('상속_취득세율셀', acqRateLabel);
  // 합계 세율 표시 동기화
  const totalRatePct = ((acqRate + ntsRate + I_EDU_RATE)*100).toFixed(2) + '%';
  setText('상속_합계세율표시', totalRatePct);

  setText('상속_sum_guide','사망일(상속개시일)로부터 6개월 내');

  const deathStr = $('사망일')?.value || '';
  let deadline='-';
  if(deathStr){ const d=parseLocalDate(deathStr); if(d){ deadline = formatYMD(addMonths(d,6)); } }
  setText('상속_납부기한', deadline);
}

// 이벤트 바인딩
document.addEventListener('change',e=>{
  const id = e.target?.id || '';
  if(id==='사망일'){ calc3(); }
  if(id==='isHouse' || id==='isNonHouse'){
    refreshAreaOptions();
    calc3();
  }
  if(id==='area_le_85'){
    if(e.target.checked) toggleArea('area_le_85');
    calc3();
  }
  if(id==='area_gt_85'){
    if(e.target.checked) toggleArea('area_gt_85');
    calc3();
  }
  if(id==='one_home_special'){
    calc3();
  }
});

// 초기 표시 상태 동기화
document.addEventListener('DOMContentLoaded', refreshAreaOptions);

function openPrint(){ try{ calc2(); calc3(); setTimeout(()=>window.print(),0);}catch(e){ window.print(); } }
</script>

<script>
// --- PWA 설치 로직 (설치 가능/불가 모두 동작 + 설치 후 자동 숨김) ---
let deferredPrompt=null;

function isStandalone(){
  try{
    return window.matchMedia('(display-mode: standalone)').matches
      || window.matchMedia('(display-mode: window-controls-overlay)').matches
      || window.navigator.standalone === true; // iOS
  }catch(e){ return false; }
}
function setInstallButtonsVisible(visible){
  document.querySelectorAll('.btn-install').forEach(el=>{ el.style.display = visible ? '' : 'none'; });
  document.body.classList.toggle('installed', !visible);
}
function updateInstallUI(){
  const installed = isStandalone();
  setInstallButtonsVisible(!installed);
}

// iOS Safari 감지 (프롬프트 미지원)
const isiOS = /iPad|iPhone|iPod/i.test(navigator.userAgent);
const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);

// 설치 가능 프롬프트 수신
window.addEventListener('beforeinstallprompt',(e)=>{
  e.preventDefault();
  deferredPrompt=e;
  // 설치 가능 조건 충족 → 설치 버튼 보이기 (이미 설치된 경우는 숨김 유지)
  updateInstallUI();
});

// 설치 완료 시 버튼 숨김 + 새로고침으로 상태 반영
window.addEventListener('appinstalled', ()=>{
  deferredPrompt=null;
  setInstallButtonsVisible(false);
  setTimeout(()=>{ try{ location.reload(); }catch(e){} }, 300);
});

async function openInstall(){
  try{
    if(isStandalone()){
      setInstallButtonsVisible(false);
      return;
    }
    if(deferredPrompt){
      deferredPrompt.prompt();
      const choice = await deferredPrompt.userChoice.catch(()=>null);
      deferredPrompt=null;
      if(!choice || choice.outcome!=='accepted'){
        updateInstallUI();
      }
      return;
    }
    if(isiOS && isSafari){
      alert('iOS 사파리: 공유(⬆️) 버튼 → "홈 화면에 추가"를 눌러 설치하세요.');
    }else{
      alert('브라우저 메뉴에서 "앱 설치" 또는 주소창 우측 설치 아이콘을 눌러 설치하세요.');
    }
  }catch(e){
    console.error(e);
  }
}

// 페이지 진입/표시 때마다 상태 재평가
['load','pageshow','visibilitychange'].forEach(evt=>{
  window.addEventListener(evt, updateInstallUI);
});

// display-mode 변화 감지 (지원 브라우저)
try{ window.matchMedia('(display-mode: standalone)').addEventListener('change', updateInstallUI); }catch(e){}
</script>
<script>
// [보강 스크립트] 설치 후에도 버튼이 남는 경우 강제 숨김 처리
(function(){
  const LS_KEY='pwaInstalled';
  function isStandalone(){
    try{
      return window.matchMedia('(display-mode: standalone)').matches
        || window.matchMedia('(display-mode: window-controls-overlay)').matches
        || window.navigator.standalone === true; // iOS
    }catch(e){ return false; }
  }
  function hideInstallButtons(){
    document.querySelectorAll('.btn-install').forEach(el=>{ el.style.display='none'; });
    document.body.classList.add('installed');
  }
  function update(){
    if(isStandalone() || localStorage.getItem(LS_KEY)==='1'){
      hideInstallButtons();
    }
  }
  // 초기/이벤트 훅
  update();
  document.addEventListener('DOMContentLoaded', update);
  window.addEventListener('pageshow', update);
  window.addEventListener('visibilitychange', update);
  try{
    const mq1 = window.matchMedia('(display-mode: standalone)');
    mq1.addEventListener?.('change', update);
    const mq2 = window.matchMedia('(display-mode: window-controls-overlay)');
    mq2.addEventListener?.('change', update);
  }catch(e){}
  window.addEventListener('appinstalled', ()=>{ localStorage.setItem(LS_KEY,'1'); update(); });
  // install 버튼 클릭 후 accept 시에도 즉시 숨김
  const _openInstall = window.openInstall;
  window.openInstall = function(){
    try{
      if(typeof _openInstall === 'function'){
        const ret = _openInstall();
        try{ setTimeout(update, 1000); }catch(e){}
        return ret;
      }
    }catch(e){}
  };
})();
</script>
</body>
</html>
.
